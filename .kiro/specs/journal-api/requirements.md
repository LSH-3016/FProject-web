# 요구사항 문서

## 소개

이 문서는 JournalBook 컴포넌트를 위한 백엔드 API의 요구사항을 정의합니다. 사용자가 일기 형식의 메시지를 작성, 조회, 삭제하고, AI 기반 요약을 생성할 수 있는 RESTful API를 제공합니다.

## 용어 정의

- **시스템**: Journal API 백엔드 시스템
- **사용자**: 인증된 애플리케이션 사용자
- **메시지**: 사용자가 작성한 일기 항목
- **요약**: AI가 생성한 메시지 요약 및 감정 분석 결과
- **감정**: 메시지에서 추출된 감정 데이터 (긍정, 중립, 부정)

## 요구사항

### 요구사항 1

**사용자 스토리:** 사용자로서, 나는 내 일기 메시지를 조회하고 싶다. 그래야 과거 기록을 볼 수 있기 때문이다.

#### 수락 기준

1. WHEN 사용자가 메시지를 요청하면 THEN 시스템은 해당 사용자의 모든 메시지를 생성 시간 내림차순으로 반환해야 한다
2. WHEN 사용자가 페이지네이션 파라미터와 함께 메시지를 요청하면 THEN 시스템은 주어진 오프셋부터 지정된 개수의 메시지를 반환해야 한다
3. WHEN 사용자가 존재하지 않는 사용자 ID로 메시지를 요청하면 THEN 시스템은 빈 배열을 반환해야 한다
4. WHEN 응답에 메시지가 포함되면 THEN 시스템은 각 메시지에 대해 메시지 ID, 사용자 ID, 내용, 생성 시간을 포함해야 한다
5. WHERE 페이지네이션이 사용되면, 시스템은 기본값 100과 0을 가진 limit과 offset 쿼리 파라미터를 받아들여야 한다

### 요구사항 2

**사용자 스토리:** 사용자로서, 나는 새로운 일기 메시지를 작성하고 싶다. 그래야 일상의 생각과 경험을 기록할 수 있기 때문이다.

#### 수락 기준

1. WHEN 사용자가 유효한 내용으로 메시지를 제출하면 THEN 시스템은 새 메시지 레코드를 생성하고 고유 ID가 포함된 생성된 메시지를 반환해야 한다
2. WHEN 사용자가 빈 내용 또는 공백만 있는 내용으로 메시지를 제출하면 THEN 시스템은 요청을 거부하고 유효성 검증 오류를 반환해야 한다
3. WHEN 메시지가 생성되면 THEN 시스템은 생성 시간을 현재 서버 시간으로 자동 설정해야 한다
4. WHEN 메시지가 성공적으로 생성되면 THEN 시스템은 완전한 메시지 객체와 함께 HTTP 상태 201을 반환해야 한다
5. WHEN 요청 본문에 필수 필드가 누락되면 THEN 시스템은 설명적인 오류 메시지와 함께 HTTP 상태 400을 반환해야 한다

### 요구사항 3

**사용자 스토리:** 사용자로서, 나는 내 일기 메시지를 삭제하고 싶다. 그래야 더 이상 보관하고 싶지 않은 항목을 제거할 수 있기 때문이다.

#### 수락 기준

1. WHEN 사용자가 자신의 메시지 삭제를 요청하면 THEN 시스템은 데이터베이스에서 메시지를 제거하고 HTTP 상태 204를 반환해야 한다
2. WHEN 사용자가 존재하지 않는 메시지를 삭제하려고 시도하면 THEN 시스템은 HTTP 상태 404를 반환해야 한다
3. WHEN 사용자가 다른 사용자의 메시지를 삭제하려고 시도하면 THEN 시스템은 HTTP 상태 403을 반환해야 한다
4. WHEN 메시지가 삭제되면 THEN 시스템은 메시지가 영구적으로 제거되어 조회할 수 없도록 보장해야 한다
5. WHEN 삭제 요청이 처리되면 THEN 시스템은 2초 이내에 작업을 완료해야 한다

### 요구사항 4

**사용자 스토리:** 사용자로서, 나는 일기 항목의 AI 기반 요약을 생성하고 싶다. 그래야 내 감정 패턴과 경험에 대한 통찰을 얻을 수 있기 때문이다.

#### 수락 기준

1. WHEN 사용자가 메시지 요약을 요청하면 THEN 시스템은 지정된 날짜 범위 내의 모든 메시지를 분석하고 감정 분석이 포함된 요약을 반환해야 한다
2. WHEN 요약을 생성하면 THEN 시스템은 최소 3개의 주요 감정과 각각의 백분율을 식별하고 반환해야 한다
3. WHEN 요약이 생성되면 THEN 시스템은 사용자의 감정 여정을 반영하는 서술 텍스트를 포함해야 한다
4. WHEN 요약 요청에 날짜 범위가 포함되면 THEN 시스템은 해당 범위 내에 생성된 메시지만 분석해야 한다
5. WHEN 주어진 기준에 대한 메시지가 존재하지 않으면 THEN 시스템은 적절한 메시지와 함께 HTTP 상태 404를 반환해야 한다

### 요구사항 5

**사용자 스토리:** 개발자로서, 나는 모든 API 엔드포인트에서 일관된 오류 처리를 원한다. 그래야 클라이언트 애플리케이션이 오류를 안정적으로 처리할 수 있기 때문이다.

#### 수락 기준

1. WHEN API 오류가 발생하면 THEN 시스템은 오류 코드와 설명 메시지가 포함된 JSON 응답을 반환해야 한다
2. WHEN 유효성 검증이 실패하면 THEN 시스템은 어떤 필드가 검증에 실패했는지에 대한 세부 정보와 함께 HTTP 상태 400을 반환해야 한다
3. WHEN 인증이 실패하면 THEN 시스템은 인증 오류 메시지와 함께 HTTP 상태 401을 반환해야 한다
4. WHEN 권한 부여가 실패하면 THEN 시스템은 권한 부여 오류 메시지와 함께 HTTP 상태 403을 반환해야 한다
5. WHEN 서버 오류가 발생하면 THEN 시스템은 HTTP 상태 500을 반환하고 디버깅을 위해 오류 세부 정보를 로깅해야 한다

### 요구사항 6

**사용자 스토리:** 시스템 관리자로서, 나는 API 요청이 인증되고 권한이 부여되기를 원한다. 그래야 사용자 데이터가 안전하게 유지되기 때문이다.

#### 수락 기준

1. WHEN API 엔드포인트가 호출되면 THEN 시스템은 유효한 인증 토큰의 존재를 검증해야 한다
2. WHEN 요청에 인증 자격 증명이 없으면 THEN 시스템은 HTTP 상태 401로 요청을 거부해야 한다
3. WHEN 사용자가 다른 사용자의 리소스에 접근하려고 시도하면 THEN 시스템은 소유권을 확인하고 HTTP 상태 403으로 무단 접근을 거부해야 한다
4. WHEN 인증 토큰이 만료되면 THEN 시스템은 만료된 토큰으로 요청을 거부하고 HTTP 상태 401을 반환해야 한다
5. WHERE 사용자 ID가 필요하면, 시스템은 요청 파라미터로 받는 대신 인증된 세션에서 추출해야 한다

### 요구사항 7

**사용자 스토리:** 개발자로서, 나는 API 응답이 일관된 형식 표준을 따르기를 원한다. 그래야 클라이언트 통합이 간단해지기 때문이다.

#### 수락 기준

1. WHEN 성공적인 응답이 반환되면 THEN 시스템은 일관된 필드 명명 규칙(snake_case)을 가진 JSON 형식을 사용해야 한다
2. WHEN 타임스탬프가 포함되면 THEN 시스템은 시간대 정보가 포함된 ISO 8601 문자열로 형식화해야 한다
3. WHEN 페이지네이션이 사용되면 THEN 시스템은 총 개수, 현재 오프셋, 제한에 대한 메타데이터를 포함해야 한다
4. WHEN 배열이 반환되면 THEN 시스템은 지정된 정렬 기준에 따라 일관된 순서를 보장해야 한다
5. WHEN null 값이 존재하면 THEN 시스템은 필드를 생략하는 대신 null 값과 함께 필드를 포함해야 한다
